<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ“Š Admin Dashboard | Lightbringer</title>
  <link rel="stylesheet" href="/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container dashboard">
    <header>
      <h2>ğŸ“Š Admin Dashboard</h2>
      <p class="subtitle">Faucet statistics and management</p>
    </header>

    <!-- Stats Grid -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">ğŸ‘¥</div>
        <div class="stat-value"><%= stats.users %></div>
        <div class="stat-label">Total Users</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ’¸</div>
        <div class="stat-value"><%= stats.payments %></div>
        <div class="stat-label">Total Payments</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ“¢</div>
        <div class="stat-value"><%= stats.ads %></div>
        <div class="stat-label">Active Ads</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ’°</div>
        <div class="stat-value"><%= stats.totalPaid %></div>
        <div class="stat-label">Satoshi Paid</div>
      </div>
    </div>

    <!-- Recent Payments -->
    <div class="data-section">
      <h3>ğŸ’¸ Recent Payments</h3>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Time</th>
              <th>To Address</th>
              <th>Amount (sat)</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <% if (recentPayments.length === 0) { %>
            <tr>
              <td colspan="5" style="text-align: center;">No payments yet</td>
            </tr>
            <% } else { %>
              <% recentPayments.forEach(payment => { %>
              <tr>
                <td>#<%= payment.id %></td>
                <td><%= new Date(payment.time * 1000).toLocaleString() %></td>
                <td><%= payment.to_address %></td>
                <td><%= payment.sat %></td>
                <td>
                  <% 
                    let resp = {};
                    try { resp = JSON.parse(payment.response); } catch(e) {}
                    const status = resp.status === true || resp.status === 'success' ? 'âœ…' : 'âŒ';
                  %>
                  <%= status %>
                </td>
              </tr>
              <% }); %>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Recent Ads -->
    <div class="data-section">
      <h3>ğŸ“¢ Recent Ads</h3>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Title</th>
              <th>URL</th>
              <th>Time</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <% if (recentAds.length === 0) { %>
            <tr>
              <td colspan="5" style="text-align: center;">No ads yet</td>
            </tr>
            <% } else { %>
              <% recentAds.forEach(ad => { %>
              <tr>
                <td>#<%= ad.id %></td>
                <td><%= ad.title %></td>
                <td><a href="<%= ad.url %>" target="_blank" class="link-small"><%= ad.url.substring(0, 40) %>...</a></td>
                <td><%= new Date(ad.time * 1000).toLocaleString() %></td>
                <td>
                  <% if (ad.active) { %>
                  <button onclick="deleteAd(<%= ad.id %>)" class="btn-delete">ğŸ—‘ï¸ Delete</button>
                  <% } else { %>
                  <span style="color: #888;">Deleted</span>
                  <% } %>
                </td>
              </tr>
              <% }); %>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>

    <div class="nav-links">
      <a href="/" class="link">â† Back to Faucet</a>
      <a href="/logout" class="link">ğŸšª Logout</a>
    </div>

    <footer>
      <small>âš¡ Powered by Lightbringer</small>
    </footer>
  </div>

  <script>
    async function deleteAd(id) {
      if (!confirm('Are you sure you want to delete this ad?')) return;
      
      try {
        const response = await fetch(`/admin/delete-ad/${id}`, {
          method: 'POST'
        });
        
        const data = await response.json();
        alert(data.message);
        location.reload();
      } catch (error) {
        alert('Error deleting ad');
      }
    }
  </script>
</body>
</html>
